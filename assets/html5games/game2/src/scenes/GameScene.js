import Phaser from"../lib/phaser.js";import AudioManager from"./AudioManager.js";import{createCoinFlipAnimation}from"./coinFlipAnimation.js";import CardModule from"./CardModule.js";export default class GameScene extends Phaser.Scene{constructor(){super("GameScene"),this.audioManager=null,this.winnerImage=null,this.failureImage=null,this.gameOverImage=null,this.scores=0,this.scoreText=null,this.playerCardsCount=0,this.playerCardsCountText=null,this.aiCardsCount=0,this.aiCardsCountText=null,this.currentScore=0,this.newScore=0,this.numberOfCardsInDecks=0}init(s){this.numberOfCardsInDecks=s,this.audioManager=this.scene.get("MainMenuScene").audioManager}preload(){this.load.image("game-background","assets/img/hud/game-bg.jpg"),this.load.image("coinYou","assets/img/Flip_coin/gold_u.png"),this.load.image("coin2","assets/img/Flip_coin/gold_2.png"),this.load.image("coin3","assets/img/Flip_coin/gold_3.png"),this.load.image("coin4","assets/img/Flip_coin/gold_4.png"),this.load.image("coinAI","assets/img/Flip_coin/gold_AI.png"),this.load.image("cardFront","assets/img/cards/cardFront.png"),this.load.image("cardBack","assets/img/cards/cardBack.png"),this.load.json("player_cardData","assets/json/player_cardData.json"),this.load.json("ai_cardData","assets/json/ai_cardData.json"),this.load.image("yourCards","assets/img/hud/yourCards.png"),this.load.image("opponentsCards","assets/img/hud/opponentsCards.png"),this.load.image("scoreBoard","assets/img/hud/scoreBoard.png"),this.load.image("music-on","assets/img/hud/musicOn.png"),this.load.image("music-off","assets/img/hud/musicOff.png"),this.load.image("youWon","assets/img/hud/youWon.png"),this.load.image("youLost","assets/img/hud/youLost.png"),this.load.image("gameOverImage","assets/img/hud/gameOver_bg.png"),this.load.image("menu","assets/img/hud/menu.png"),this.load.image("retry","assets/img/hud/restart.png"),this.load.image("Virat Kohli","assets/img/Player_photos/Virat-kohli.png"),this.load.image("Kane Williamson","assets/img/Player_photos/kane_williamson.png"),this.load.image("Joe Root","assets/img/Player_photos/Rohit_sharma.png"),this.load.image("Babar Azam","assets/img/Player_photos/Babar_azam.png"),this.load.image("Dawid warner","assets/img/Player_photos/dawid_warner.png"),this.load.image("Goutam ghambir","assets/img/Player_photos/Goutam_ghambir.png"),this.load.image("Harbajan","assets/img/Player_photos/Harbajan.png"),this.load.image("Kagiso-Rabada","assets/img/Player_photos/Kagiso-Rabada.png"),this.load.image("MsDhoni","assets/img/Player_photos/MsDhoni.png"),this.load.image("Ravindra_jadeja","assets/img/Player_photos/Ravindra_jadeja.png"),this.load.image("sachin","assets/img/Player_photos/sachin.png"),this.load.image("verander_sawag","assets/img/Player_photos/verander_sawag.png"),this.load.image("Steve Smith","assets/img/Player_photos/kane_williamson.png")}create(){this.audioManager.playBackgroundMusic(),this.cardModule=new CardModule(this,this.audioManager),this.cameras.main.setPostPipeline("Glow"),this.playerCardsCount=this.numberOfCardsInDecks,this.aiCardsCount=this.numberOfCardsInDecks;const s=this.sys.game.config.width/2,e=this.sys.game.config.height/2,i=(this.add.image(0,0,"game-background").setOrigin(0),Math.random()<.5?"ai":"player");createCoinFlipAnimation(this,s,e,i,(s=>{this.time.delayedCall(1e3,(()=>{this.startGame(`${s}`)}))}))}startGame(s){this.cardModule.currentPlayer=s,this.cardModule.initializeDecks(this.numberOfCardsInDecks,s),this.showHud()}UpdateScores(s){"player"===s?(this.scores+=100,this.time.delayedCall(100,(()=>{this.winnerImage.setVisible(!0),this.audioManager.playWinRound()})),this.time.delayedCall(1e3,(()=>{this.winnerImage.setVisible(!1)}))):(this.scores-=100,this.time.delayedCall(100,(()=>{this.failureImage.setVisible(!0),this.audioManager.playFailureRound()})),this.time.delayedCall(1e3,(()=>{this.failureImage.setVisible(!1)}))),this.currentScore=this.newScore,this.newScore=this.scores,this.scoreText.setText(this.scores),this.aiCardsCountText.setText(this.cardModule.aiCards.length),this.playerCardsCountText.setText(this.cardModule.playerCards.length)}showHud(){this.winnerImage=this.add.image(this.sys.game.config.width/2,this.sys.game.config.height/2,"youWon").setOrigin(.5,.5).setVisible(!1).setDepth(1),this.failureImage=this.add.image(this.sys.game.config.width/2,this.sys.game.config.height/2,"youLost").setOrigin(.5,.5).setVisible(!1).setDepth(1);const s=this.add.image(this.sys.game.config.width/2-300,this.sys.game.config.height-20,"yourCards").setScale(.25).setOrigin(1,1);this.playerCardsCountText=this.add.text(s.x-100,s.y-100,this.playerCardsCount,{fontFamily:"grobold",fontSize:"80px",fontStyle:"bold",fill:"#ffffff"}),this.playerCardsCountText.setOrigin(0,0),this.add.existing(this.playerCardsCountText);const e=this.add.image(this.sys.game.config.width-100,this.sys.game.config.height-20,"opponentsCards").setScale(.25).setOrigin(1,1);this.aiCardsCountText=this.add.text(e.x-500,e.y-80,this.aiCardsCount,{fontFamily:"grobold",fontSize:"80px",fontStyle:"bold",fill:"#ffffff"}),this.aiCardsCountText.setOrigin(.5,.5),this.add.existing(this.aiCardsCountText),this.add.image(this.sys.game.config.width-80,60,"music-off").setScale(.15).setOrigin(.5,.5);let i=!1;const a=this.add.image(this.sys.game.config.width-80,60,"music-on").setScale(.15).setOrigin(.5,.5);a.on("pointerdown",(()=>{i=!i,i?(this.audioManager.playBackgroundMusic(),a.setTexture("music-on")):(this.audioManager.stopBackgroundMusic(),a.setTexture("music-off"))})),a.setInteractive();const t=this.add.image(10,10,"scoreBoard").setScale(.15).setOrigin(0,0);this.scoreText=this.add.text(t.x+200,t.y+10,this.scores,{fontFamily:"grobold",fontSize:"40px",fontStyle:"bold",fill:"#ffffff"}),this.scoreText.setOrigin(0,0),this.add.existing(this.scoreText),this.UpdateScoreNumbers(this.currentScore,this.newScore)}UpdateScoreNumbers(s,e){let i=this.tweens.addCounter({from:s,to:e,duration:2e3,ease:"linear",onUpdate:s=>{const e=Math.round(s.getValue());this.scoreText.setText(`${e}`)}});i.isPlaying()?i.updateTo("value",e):i=this.tweens.addCounter({from:s,to:e,duration:2e3,ease:"linear",onUpdate:s=>{const e=Math.round(s.getValue());this.scoreText.setText(`${e}`)}})}showGameOverScreen(){this.audioManager.playGameOver();const s=this.sys.game.config.width/2,e=this.sys.game.config.height/2,i=this.add.group();this.gameOverImage=this.add.image(s,e,"gameOverImage").setOrigin(.5).setScale(1.4,1.2),i.add(this.gameOverImage);const a=this.add.text(s,e+80,` ${this.scores}`,{fontFamily:"grobold",fontSize:"40px",fontStyle:"bold",fill:"#ffffff"}).setOrigin(.5);i.add(a);const t=this.add.image(s-110,e+200,"menu",{fontFamily:"grobold",fontSize:"30px",fontStyle:"bold",fill:"#ffffff"}).setOrigin(.5).setInteractive();i.add(t);const o=this.add.image(s+110,e+200,"retry",{fontFamily:"grobold",fontSize:"30px",fontStyle:"bold",fill:"#ffffff"}).setOrigin(.5).setInteractive();i.add(o),o.on("pointerdown",(()=>{this.scores=0,this.UpdateScoreNumbers(this.currentScore,this.newScore),this.scene.restart()})),t.on("pointerdown",(()=>{this.scores=0,this.UpdateScoreNumbers(this.currentScore,this.newScore),this.scene.start("MainMenuScene")})),i.setVisible(!0)}}